(this.webpackJsonpauthspa=this.webpackJsonpauthspa||[]).push([[0],{13:function(e,t,a){e.exports=a(19)},18:function(e,t,a){},19:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(11),i=a.n(s),o=a(5),l=a(1),c=a(3),u=a(4),d=a(2),m=a(9),p=a(7),h=a(12),v=function(e){var t,a={},n=Object(h.a)(e.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value;"submit"!==r.type&&"button"!==r.type&&(a[r.name]="checkbox"!==r.type?e[r.name].value:e[r.name].checked)}}catch(s){n.e(s)}finally{n.f()}return a},f=function(e){return e.dataset.notouched},b=function(e,t){e.dataset.notouched&&(e.dataset.notouched=t)},g="This field may not be blank.",y=function(e){return"Minimal length this field ".concat(e)},k=function(e){return"Maximal length this field ".concat(e)},E="Value does not match pattern",O=function(){function e(t,a){var n=this;Object(c.a)(this,e),this.initValidation=function(){n.checkers.forEach((function(e){var t,a=n.form[e.fieldName],r=[];switch(e.checkName){case"required":t=[n.required],r=[g];break;case"username_simple":t=[n.required,n.minLength.bind(n,1),n.maxLength.bind(n,150)],r=[g,y(1),k(150)];break;case"username":t=[n.required,n.minLength.bind(n,1),n.maxLength.bind(n,150),n.regExp.bind(n,"^[\\w.@+-]+$")],r=[g,y(1),k(150),"Letters, digits and @/./+/-/_ only"];break;case"password":t=[n.minLength.bind(n,1),n.maxLength.bind(n,128),n.regExp.bind(n,"^(?=.*[A-Z])(?=.*\\d).{8,}$")],r=[y(1),k(128),E];break;case"firstname":t=[n.maxLength.bind(n,30)],r=[k(30)];break;case"lastname":t=[n.maxLength.bind(n,150)],r=[k(150)];break;default:t=[]}a.checkers=t,a.msgSet=r,a.errorBox=a.nextElementSibling}))},this.form=t,this.submitbtn=t.querySelector('[type="submit"]'),this.checkers=a.filter((function(e){return e.validator})).map((function(e){return{fieldName:e.name,checkName:e.validator}})),this.initValidation(),this.toggleDisabledBtn()}return Object(u.a)(e,[{key:"minLength",value:function(e,t){return t.length>=e}},{key:"maxLength",value:function(e,t){return t.length<=e}},{key:"required",value:function(e){return!!e&&!!e.trim().length}},{key:"regExp",value:function(e,t){return new RegExp(e).test(t)}},{key:"checkValidByName",value:function(e,t){var a,n,r=this.form[e];if(r.checkers)for(var s=r.checkers.length,i=0;i<s;i++){var o=r.checkers[i]("undefined"===typeof t?r.value:t);n=o,(a=r).dataset.valid&&(a.dataset.valid=n),!1===o&&"true"!==f(r)?(r.classList.add("App-errorField"),r.errorBox.classList.add("App-errorMsg"),r.errorBox.innerHTML=r.msgSet[i],i=s):(r.classList.remove("App-errorField"),r.errorBox.classList.remove("App-errorMsg"),r.errorBox.innerHTML=""),o||(i=s)}}},{key:"toggleDisabledBtn",value:function(){this.submitbtn&&(this.submitbtn.disabled=!this.valid)}},{key:"resetPropertiesByName",value:function(e,t){var a=this.form[e];a&&(b(a,!t),this.checkValidByName(e,t))}},{key:"validate",value:function(){var e,t=this;return(e=this.form,Array.from(e.elements).filter((function(e){return"valid"in e.dataset}))).forEach((function(e){b(e,!1),t.checkValidByName(e.name)})),this.valid}},{key:"valid",get:function(){var e=this;return this.checkers.reduce((function(t,a){var n=a.fieldName,r=e.form[n];return t&&("true"===r.dataset.valid||"true"===f(r))}),!0)}}]),e}();function S(e){var t=e.opts,a=t.id,n=t.type,s=t.name,i=t.label,o=t.readOnly,l=t.validator,c=t.requiredView,u={id:a,type:n,name:s,readOnly:o};l&&(u["data-valid"]=!1,u["data-notouched"]=!(e.value.length>0));var d="checkbox"===n?{checked:e.value}:{value:e.value},m=c?r.a.createElement("span",{className:"App-required"},"*"):null;return r.a.createElement("div",{className:"App-inputBox"},r.a.createElement("label",{htmlFor:a,className:"App-label ".concat(o?"App-label--readonly":"")},i,m),r.a.createElement("input",Object.assign({className:"App-inputText"},u,d,{onChange:e.changeHandler})),r.a.createElement("div",{className:"App-gap"}))}var j=a(6),w=function(e){console.log("FETCH ERROR: ",e)};function N(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"POST",r=arguments.length>4?arguments[4]:void 0,s={"Content-Type":"application/json;charset=utf-8"};r&&(s.Authorization="Token ".concat(r)),fetch(e,{method:n,headers:s,body:JSON.stringify(Object(j.a)({},t))}).then((function(e){return e.json()}),w).then(a,w)}function x(e){return r.a.createElement("div",{className:"App-serverMsg ".concat(e.classNameModify?e.classNameModify:"")},e.msg)}var A=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).inputs=[{name:"username",type:"text",id:"userLogin",label:"Username",validator:"username_simple",requiredView:!0},{name:"password",type:"password",id:"userPassword",label:"Password",validator:"required",requiredView:!0}],n.handleInputChange=n.handleInputChange.bind(Object(d.a)(n)),n.handleSubmitForm=n.handleSubmitForm.bind(Object(d.a)(n)),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.formRef.current;e&&(this.validator=new O(e,this.inputs))}},{key:"render",value:function(){var e=this;if(this.props.token)return null;var t=this.inputs.map((function(t){var a={};return t.validator&&(a.validator=t.validator),r.a.createElement(S,Object.assign({key:t.id,opts:t},a,{value:e.state&&e.state[t.name]||"",changeHandler:function(t){e.handleInputChange(t)}}))})),a=this.state&&this.state.serverMsg&&r.a.createElement(x,{msg:this.state.serverMsg,classNameModify:"App-serverMsg--error"});return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:this.handleSubmitForm,ref:this.props.formRef},t,r.a.createElement("div",{className:"App-buttonBox"},r.a.createElement("input",{className:"App-button",type:"submit",value:"Send"}))),a)}},{key:"handleInputChange",value:function(e){var t,a=e.target,n=a.name;this.setState((t={},Object(l.a)(t,n,a.value),Object(l.a)(t,"serverMsg",null),t)),this.validator.checkValidByName(n),this.validator.toggleDisabledBtn()}},{key:"handleSubmitForm",value:function(e){var t=this;e.preventDefault(),new Promise((function(e){e(t.validator.validate())})).then((function(e){e&&N("https://emphasoft-test-assignment.herokuapp.com/api-token-auth/",v(t.props.formRef.current),(function(e){var a,n=null;e.non_field_errors&&(n=e.non_field_errors.join("\n")),t.setState({serverMsg:n}),e.token&&(!function(e){if(e){var t=new Date((new Date).getTime()+36e5);localStorage.setItem("expiredDate",t),localStorage.setItem("token",e)}else localStorage.clear()}(e.token),t.props.setStateToken(e.token),a=t.state.username,localStorage.setItem("username",a),t.props.setUsername(t.state.username))})),t.validator.toggleDisabledBtn()}))}}]),a}(r.a.Component),B=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).inputs=[{name:"id",type:"text",id:"userEditId",label:"ID",readOnly:!0},{name:"username",type:"text",id:"userEditLogin",label:"Username",validator:"username",requiredView:!0},{name:"first_name",type:"text",id:"userEditFirstName",label:"First name",validator:"firstname"},{name:"last_name",type:"text",id:"userEditLastName",label:"Last name",validator:"lastname"},{name:"password",type:"password",id:"userEditPassword",label:"Password",validator:"password",requiredView:!0},{name:"is_active",type:"checkbox",id:"userIsActive",label:"Active",requiredView:!0},{name:"is_superuser",type:"checkbox",id:"userIsSuper",label:"Superuser status",readOnly:!0}],n.handleSubmitForm=n.handleSubmitForm.bind(Object(d.a)(n)),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.formRef.current;e&&(this.validator=new O(e,this.inputs)),this.updateUserData(this.props.data)}},{key:"componentDidUpdate",value:function(e){if(e.data.id!==this.props.data.id){for(var t in this.updateUserData(this.props.data),this.props.data)this.validator.resetPropertiesByName(t,this.props.data[t]);"password"in this.props.data||(this.updateUserData({password:""}),this.validator.resetPropertiesByName("password","")),this.validator.toggleDisabledBtn()}}},{key:"render",value:function(){var e=this,t=this.inputs.map((function(t){var a={};return t.validator&&(a.validator=t.validator),r.a.createElement(S,Object.assign({key:t.id,opts:t},a,{value:e.state&&e.state[t.name]||"",changeHandler:function(t){e.handleInputChange(t)}}))})),a=this.state&&this.state.serverMsg&&r.a.createElement(x,{msg:this.state.serverMsg});return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:this.handleSubmitForm,ref:this.props.formRef},t,r.a.createElement("div",{className:"App-buttonBox"},r.a.createElement("input",{className:"App-button",type:"submit",value:"Save"}))),a)}},{key:"handleInputChange",value:function(e){var t=e.target;if(!t.readOnly){var a,n=t.name,r="checkbox"===t.type?t.checked:t.value;this.setState((a={},Object(l.a)(a,n,r),Object(l.a)(a,"serverMsg",null),a)),this.validator.checkValidByName(n),this.validator.toggleDisabledBtn()}}},{key:"handleSubmitForm",value:function(e){var t=this;e.preventDefault(),new Promise((function(e){e(t.validator.validate())})).then((function(e){if(e){var a=t.props,n=a.token,r=a.updateUsers,s=t.props.formRef.current,i=t.state.id?"PATCH":"POST",o=v(s),l="https://emphasoft-test-assignment.herokuapp.com/api/v1/users/";if(t.state.id)l="".concat(l).concat(t.state.id,"/");else{var c=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a="",n="0123456789".concat(t?"":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),r=n.length,s=0;s<e;s++)a+=n.charAt(Math.floor(Math.random()*r));return t?+a:a}(4);o.id=c}N(l,o,(function(e){var a=e.detail;a&&t.setState({serverMsg:a}),r(),t.updateUserData(t.props.emptyUser)}),i,n)}}))}},{key:"updateUserData",value:function(e){this.setState(Object(j.a)({},e))}}]),a}(r.a.Component);function M(e){var t=e.usersSet.map((function(e,t){return r.a.createElement("option",{value:++t,key:"user_".concat(e.id)},e.username)}));return r.a.createElement("div",{className:"App-selectBox"},r.a.createElement("select",{className:"App-select",value:e.value,onChange:e.changeHandler},r.a.createElement("option",{value:0},"--"),t))}a(18);function D(e,t){fetch("https://emphasoft-test-assignment.herokuapp.com/api/v1/users/",{method:"GET",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Token ".concat(e)}}).then((function(e){return e.json()})).then((function(e){t(e)}))}var L=function(){var e=Object(n.useState)(function(){var e=localStorage.getItem("expiredDate");if(e){if(new Date<new Date(e))return localStorage.getItem("token");localStorage.clear()}return null}()),t=Object(o.a)(e,2),a=t[0],s=t[1],i=Object(n.useState)(localStorage.getItem("username")),l=Object(o.a)(i,2),c=l[0],u=l[1],d=Object(n.useState)(0),m=Object(o.a)(d,2),p=m[0],h=m[1],v=Object(n.useState)([]),f=Object(o.a)(v,2),b=f[0],g=f[1],y=Object(n.useState)(!0),k=Object(o.a)(y,2),E=k[0],O=k[1],S=Object(n.useRef)(null),j=Object(n.useRef)(null);a&&E&&(O(!1),D(a,g));var w=a?r.a.createElement("div",{className:"App-titleBox"},r.a.createElement("h4",null,"Please add user or edit current from list"),r.a.createElement(M,{usersSet:b,value:p,changeHandler:function(e){h(+e.target.value)}})):null,N={id:null,username:"",first_name:"",last_name:"",password:"",is_active:!0,is_superuser:!1},x={data:p>0?b[p-1]:N},L=a?r.a.createElement(B,Object.assign({token:a,formRef:j},x,{updateUsers:function(){D(a,g),h(0)},emptyUser:N})):null;return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("div",{className:"App-wrapper"},"Welcome ",c||"")),r.a.createElement("div",{className:"App-body"},r.a.createElement("div",{className:"App-wrapper"},r.a.createElement(A,{token:a,setStateToken:s,setUsername:u,formRef:S}),w,L)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[13,1,2]]]);
//# sourceMappingURL=main.b178629a.chunk.js.map

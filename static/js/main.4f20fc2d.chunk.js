(this.webpackJsonpauthspa=this.webpackJsonpauthspa||[]).push([[0],{13:function(e,t,a){e.exports=a(19)},18:function(e,t,a){},19:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(11),i=a.n(s),o=a(5),l=a(1),c=a(3),u=a(4),d=a(2),m=a(9),p=a(7),h=a(12),v=function(e){var t,a={},n=Object(h.a)(e.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value;"submit"!==r.type&&"button"!==r.type&&(a[r.name]=e[r.name].value)}}catch(s){n.e(s)}finally{n.f()}return a},f=function(e){e.dataset.notouched&&(e.dataset.notouched=!1)},b="This field may not be blank.",g=function(e){return"Minimal length this field ".concat(e)},k=function(e){return"Maximal length this field ".concat(e)},y="Value does not match pattern",E=function(){function e(t,a){var n=this;Object(c.a)(this,e),this.initValidation=function(){n.checkers.forEach((function(e){var t,a=n.form[e.fieldName],r=[];switch(e.checkName){case"required":t=[n.required],r=[b];break;case"username_simple":t=[n.required,n.minLength.bind(n,1),n.maxLength.bind(n,150)],r=[b,g(1),k(150)];break;case"username":t=[n.required,n.minLength.bind(n,1),n.maxLength.bind(n,150),n.regExp.bind(n,"^[\\w.@+-]+$")],r=[b,g(1),k(150),"Letters, digits and @/./+/-/_ only"];break;case"password":t=[n.minLength.bind(n,1),n.maxLength.bind(n,128),n.regExp.bind(n,"^(?=.*[A-Z])(?=.*\\d).{8,}$")],r=[g(1),k(128),y];break;case"firstname":t=[n.maxLength.bind(n,30)],r=[k(30)];break;case"lastname":t=[n.maxLength.bind(n,150)],r=[k(150)];break;default:t=[]}a.checkers=t,a.msgSet=r,a.errorBox=a.nextElementSibling}))},this.form=t,this.submitbtn=t.querySelector('[type="submit"]'),this.checkers=a.filter((function(e){return e.validator})).map((function(e){return{fieldName:e.name,checkName:e.validator}})),this.initValidation(),this.toggleDisabledBtn()}return Object(u.a)(e,[{key:"minLength",value:function(e,t){return t.length>=e}},{key:"maxLength",value:function(e,t){return t.length<=e}},{key:"required",value:function(e){return!!e.trim().length}},{key:"regExp",value:function(e,t){return new RegExp(e).test(t)}},{key:"checkValidByName",value:function(e){var t,a,n=this.form[e];if(n.checkers)for(var r=n.checkers.length,s=0;s<r;s++){var i=n.checkers[s](n.value);a=i,(t=n).dataset.valid&&(t.dataset.valid=a),!1===i?(n.classList.add("App-errorField"),n.errorBox.classList.add("App-errorMsg"),n.errorBox.innerHTML=n.msgSet[s],s=r):(n.classList.remove("App-errorField"),n.errorBox.classList.remove("App-errorMsg"),n.errorBox.innerHTML="")}}},{key:"toggleDisabledBtn",value:function(){this.submitbtn&&(this.submitbtn.disabled=!this.valid)}},{key:"validate",value:function(){var e,t=this;(e=this.form,Array.from(e.elements).filter((function(e){return"valid"in e.dataset}))).forEach((function(e){t.checkValidByName(e.name)}))}},{key:"valid",get:function(){var e=this;return this.checkers.reduce((function(t,a){var n=a.fieldName;return t&&"true"===e.form[n].dataset.valid}),!0)}}]),e}();function O(e){var t=e.opts,a=t.id,n=t.type,s=t.name,i=t.label,o=t.readOnly,l=t.validator,c=t.requiredView,u={id:a,type:n,name:s,readOnly:o};l&&(u["data-valid"]=!1,u["data-notouched"]=!0);var d="checkbox"===n?{checked:e.value}:{value:e.value},m=c?r.a.createElement("span",{className:"App-required"},"*"):null;return r.a.createElement("div",{className:"App-inputBox"},r.a.createElement("label",{htmlFor:a,className:"App-label ".concat(o?"App-label--readonly":"")},i,m),r.a.createElement("input",Object.assign({className:"App-inputText"},u,d,{onChange:e.changeHandler})),r.a.createElement("div",{className:"App-gap"}))}var j=a(6),S=function(e){console.log("FETCH ERROR: ",e)};function x(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"POST",r=arguments.length>4?arguments[4]:void 0,s={"Content-Type":"application/json;charset=utf-8"};r&&(s.Authorization="Token ".concat(r)),fetch(e,{method:n,headers:s,body:JSON.stringify(Object(j.a)({},t))}).then((function(e){return e.json()}),S).then(a,S)}function N(e){return r.a.createElement("div",{className:"App-serverMsg ".concat(e.classNameModify?e.classNameModify:"")},e.msg)}var w=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).inputs=[{name:"username",type:"text",id:"userLogin",label:"Username",validator:"username_simple",requiredView:!0},{name:"password",type:"password",id:"userPassword",label:"Password",validator:"required",requiredView:!0}],n.handleInputChange=n.handleInputChange.bind(Object(d.a)(n)),n.handleSubmitForm=n.handleSubmitForm.bind(Object(d.a)(n)),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.validator=new E(this.props.formRef.current,this.inputs)}},{key:"render",value:function(){var e=this;if(this.props.token)return null;var t=this.inputs.map((function(t){var a={};return t.validator&&(a.validator=t.validator),r.a.createElement(O,Object.assign({key:t.id,opts:t},a,{value:e.state&&e.state[t.name]||"",changeHandler:function(t){e.handleInputChange(t)}}))})),a=this.state&&this.state.serverMsg&&r.a.createElement(N,{msg:this.state.serverMsg,classNameModify:"App-serverMsg--error"});return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:this.handleSubmitForm,ref:this.props.formRef},t,r.a.createElement("div",{className:"App-buttonBox"},r.a.createElement("input",{className:"App-button",type:"submit",value:"Send"}))),a)}},{key:"handleInputChange",value:function(e){var t,a=e.target,n=a.name;this.setState((t={},Object(l.a)(t,n,a.value),Object(l.a)(t,"serverMsg",null),t)),this.validator.checkValidByName(n),this.validator.toggleDisabledBtn(),f(a)}},{key:"handleSubmitForm",value:function(e){var t=this;e.preventDefault(),x("https://emphasoft-test-assignment.herokuapp.com/api-token-auth/",v(this.props.formRef.current),(function(e){var a=null;e.non_field_errors&&(a=e.non_field_errors.join("\n")),t.setState({serverMsg:a}),e.token&&(t.props.setToken(e.token),t.props.setUsername(t.state.username))}))}}]),a}(r.a.Component),A=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).inputs=[{name:"id",type:"text",id:"userEditId",label:"ID",readOnly:!0},{name:"username",type:"text",id:"userEditLogin",label:"Username",validator:"username",requiredView:!0},{name:"first_name",type:"text",id:"userEditFirstName",label:"First name",validator:"firstname"},{name:"last_name",type:"text",id:"userEditLastName",label:"Last name",validator:"lastname"},{name:"password",type:"password",id:"userEditPassword",label:"Password",validator:"password",requiredView:!0},{name:"is_active",type:"checkbox",id:"userIsActive",label:"Active",requiredView:!0},{name:"is_superuser",type:"checkbox",id:"userIsSuper",label:"Superuser status",readOnly:!0}],n.handleSubmitForm=n.handleSubmitForm.bind(Object(d.a)(n)),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.validator=new E(this.props.formRef.current,this.inputs),this.updateUserData(this.props.data)}},{key:"componentDidUpdate",value:function(e){e.data.id!==this.props.data.id&&this.updateUserData(this.props.data),this.validator.validate()}},{key:"render",value:function(){var e=this,t=this.inputs.map((function(t){var a={};return t.validator&&(a.validator=t.validator),r.a.createElement(O,Object.assign({key:t.id,opts:t},a,{value:e.state&&e.state[t.name]||"",changeHandler:function(t){e.handleInputChange(t)}}))})),a=this.state&&this.state.serverMsg&&r.a.createElement(N,{msg:this.state.serverMsg});return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:this.handleSubmitForm,ref:this.props.formRef},t,r.a.createElement("div",{className:"App-buttonBox"},r.a.createElement("input",{className:"App-button",type:"submit",value:"Save"}))),a)}},{key:"handleInputChange",value:function(e){var t=e.target;if(!t.readOnly){var a,n=t.name,r="checkbox"===t.type?t.checked:t.value;this.setState((a={},Object(l.a)(a,n,r),Object(l.a)(a,"serverMsg",null),a)),this.validator.checkValidByName(n),this.validator.toggleDisabledBtn(),f(t)}}},{key:"handleSubmitForm",value:function(e){var t=this;e.preventDefault();var a=this.props,n=a.token,r=a.updateUsers,s=this.props.formRef.current,i=this.state.id?"PATCH":"POST",o=v(s),l="https://emphasoft-test-assignment.herokuapp.com/api/v1/users/";if(this.state.id)l="".concat(l).concat(this.state.id,"/");else{var c=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a="",n="0123456789".concat(t?"":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),r=n.length,s=0;s<e;s++)a+=n.charAt(Math.floor(Math.random()*r));return t?+a:a}(4);o.id=c}x(l,o,(function(e){var a=e.detail;a&&t.setState({serverMsg:a}),r(),t.validator.toggleDisabledBtn()}),i,n)}},{key:"updateUserData",value:function(e){this.setState(Object(j.a)({},e))}}]),a}(r.a.Component);function M(e){var t=e.usersSet.map((function(e,t){return r.a.createElement("option",{value:++t,key:"user_".concat(e.id)},e.username)}));return r.a.createElement("div",{className:"App-selectBox"},r.a.createElement("select",{className:"App-select",value:e.value,onChange:e.changeHandler},r.a.createElement("option",{value:0},"--"),t))}a(18);function B(e,t){fetch("https://emphasoft-test-assignment.herokuapp.com/api/v1/users/",{method:"GET",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Token ".concat(e)}}).then((function(e){return e.json()})).then((function(e){t(e)}))}var L=function(){var e=Object(n.useState)(null),t=Object(o.a)(e,2),a=t[0],s=t[1],i=Object(n.useState)(null),l=Object(o.a)(i,2),c=l[0],u=l[1],d=Object(n.useState)(0),m=Object(o.a)(d,2),p=m[0],h=m[1],v=Object(n.useState)([]),f=Object(o.a)(v,2),b=f[0],g=f[1],k=Object(n.useState)(!0),y=Object(o.a)(k,2),E=y[0],O=y[1],j=Object(n.useRef)(null),S=Object(n.useRef)(null);a&&E&&(O(!1),B(a,g));var x=a?r.a.createElement("div",{className:"App-titleBox"},r.a.createElement("h4",null,"Please add user or edit current from list"),r.a.createElement(M,{usersSet:b,value:p,changeHandler:function(e){h(+e.target.value)}})):null,N={data:p>0?b[p-1]:{id:null,username:"",first_name:"",last_name:"",password:"",is_active:!0,is_superuser:!1}},L=a?r.a.createElement(A,Object.assign({token:a,formRef:S},N,{updateUsers:function(){B(a,g),h(0)}})):null;return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("div",{className:"App-wrapper"},"Welcome ",c||"")),r.a.createElement("div",{className:"App-body"},r.a.createElement("div",{className:"App-wrapper"},r.a.createElement(w,{token:a,setToken:s,setUsername:u,formRef:j}),x,L)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[13,1,2]]]);
//# sourceMappingURL=main.4f20fc2d.chunk.js.map